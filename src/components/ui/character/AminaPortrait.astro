---
// Amina Character Portrait Component
// Displays Amina's avatar with different expressions based on state

interface Props {
  expression?: 'idle' | 'success' | 'alert' | 'error';
  size?: 'sm' | 'md' | 'lg' | 'xl';
  showGlow?: boolean;
  className?: string;
  presence?: 'online' | 'idle' | 'dnd' | 'offline';
  showPresence?: boolean;
}

const {
  expression = 'idle',
  size = 'md',
  showGlow = true,
  className = '',
  presence = 'online', // Default to online since they're logged in
  showPresence = true,
} = Astro.props;

// Size mappings
const sizeClasses = {
  sm: 'w-12 h-12',
  md: 'w-20 h-20',
  lg: 'w-32 h-32',
  xl: 'w-40 h-40',
};

// Expression-based glow colors
const glowClasses = {
  idle: 'shadow-glow-crimson',
  success: 'shadow-glow-green',
  alert: 'shadow-glow-gold',
  error: 'shadow-glow-crimson',
};

// Discord-style presence colors
const presenceColors = {
  online: 'bg-discord-green',
  idle: 'bg-yellow-500',
  dnd: 'bg-red-500',
  offline: 'bg-gray-500',
};

const presenceTitles = {
  online: 'Online',
  idle: 'Idle',
  dnd: 'Do Not Disturb',
  offline: 'Offline',
};

// Indicator sizes based on portrait size
const indicatorSizes = {
  sm: 'w-3 h-3 border-2',
  md: 'w-4 h-4 border-2',
  lg: 'w-5 h-5 border-[3px]',
  xl: 'w-6 h-6 border-[3px]',
};

// TODO: Replace with actual character art when available
// For now, using styled placeholder
const portraitSrc = null; // Will be: `/src/images/amina/portrait-${expression}.png`
---

<div
  class={`amina-portrait relative ${sizeClasses[size]} ${showGlow ? glowClasses[expression] : ''} ${className}`}
>
  {
    portraitSrc ? (
      <img
        src={portraitSrc}
        alt={`Amina - ${expression}`}
        class="w-full h-full object-cover"
      />
    ) : (
      /* Placeholder until character art is ready */
      <div class="w-full h-full bg-gradient-to-br from-amina-crimson via-amina-rose-red to-amina-blood-red flex items-center justify-center relative overflow-hidden">
        {/* Circuit pattern overlay */}
        <div class="absolute inset-0 opacity-20">
          <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg">
            <pattern
              id="circuit"
              x="0"
              y="0"
              width="20"
              height="20"
              patternUnits="userSpaceOnUse"
            >
              <circle cx="2" cy="2" r="1" fill="currentColor" />
              <line
                x1="2"
                y1="2"
                x2="18"
                y2="2"
                stroke="currentColor"
                stroke-width="0.5"
              />
              <line
                x1="2"
                y1="2"
                x2="2"
                y2="18"
                stroke="currentColor"
                stroke-width="0.5"
              />
            </pattern>
            <rect width="100%" height="100%" fill="url(#circuit)" />
          </svg>
        </div>

        {/* Amina Initial */}
        <span class="text-white font-heading text-4xl font-black relative z-10">
          A
        </span>

        {/* Accent glow effect */}
        <div class="absolute inset-0 bg-gradient-to-t from-cyber-blue/20 to-transparent" />
      </div>
    )
  }

  {/* Discord-style presence indicator */}
  {
    showPresence && (
      <div
        class={`absolute bottom-0 right-0 ${indicatorSizes[size]} ${presenceColors[presence]} rounded-full border-night-black`}
        title={presenceTitles[presence]}
      />
    )
  }
</div>

<style>
  .amina-portrait {
    border-radius: 50%;
    border: 3px solid var(--amina-crimson);
    overflow: hidden;
    animation: portrait-breathe 4s ease-in-out infinite;
  }

  @keyframes portrait-breathe {
    0%,
    100% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.05);
    }
  }

  /* Expression-specific animations */
  .amina-portrait[data-expression='success'] {
    animation: portrait-success 0.6s ease-out;
  }

  @keyframes portrait-success {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.15) rotate(5deg);
    }
    100% {
      transform: scale(1);
    }
  }
</style>
